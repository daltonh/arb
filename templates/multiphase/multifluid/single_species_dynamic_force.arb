MARKDOWN
Here we add contributions to the dynamic force due to the already calculated <p_species> and <p^_species> for each disperse phase
END_MARKDOWN

VARIABLE <dynamic_force_c_<<species>>[l=<<i>>]> '<dynamic_force_c_<<species>>[l=<<i>>]>-celldivgrad[l=<<i>>](<p_f_<<species>>>)/(<phi_bounded_<<species>>>)-celldivgrad[l=<<i>>](<p^_f_<<species>>>)'

# trying different phi variables for the osmotic pressure term
REPLACEMENTS R "<<dynamic_force_f_phi_variable>>" W "<phi_f_bounded_harmonic_<<species>>>"
#REPLACEMENTS R "<<dynamic_force_f_phi_variable>>" W "<phi_f_bounded_adjacent_nob_<<species>>>" # version1, unstable in presence of large phi gradients
#REPLACEMENTS R "<<dynamic_force_f_phi_variable>>" W "<phi_f_bounded_adjacent_<<species>>>"

# now deal with dynamic_force_f
REPLACEMENTS D "<<facegrad_method>>" W "" # define scope of averaging variable, and default which is for 
IF {{ return string_test('<<dynamic_force_f_method>>','dxunit'); }}
  REPLACEMENTS S "<<facegrad_method>>" W "dxunit"
ELSE_IF {{ return string_test('<<dynamic_force_f_method>>','facegrad'); }}
  REPLACEMENTS S "<<facegrad_method>>" W ""
ELSE_IF {{ return string_test('<<dynamic_force_f_method>>','facegradadjacentcells'); }}
  REPLACEMENTS S "<<facegrad_method>>" W "adjacentcells"
END_IF

VARIABLE <dynamic_force_f_<<species>>> "<dynamic_force_f_<<species>>>-facegrad[<<facegrad_method>>](<p_<<species>>>)/(<<dynamic_force_f_phi_variable>>)-facegrad[<<facegrad_method>>](<p^_<<species>>>)"
