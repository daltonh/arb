# here we evaluate the momentum equations using vof_stress knowledge

# create cell centred stress that represents stress acting across vof interface
# <vof_ugrad_l> and <phi_normal_c> and magnitude are already calculated
NONE_CONSTANT <vof_ugrad_l_constant> 4.d0
<<dim1comment>>CELL_CONSTANT <vof_ugrad_multiplier[l=1]> "<phi_normal_c[l=1]>*<vof_ugrad_l_constant>/(<vof_ugrad_l>*<phi_normal_c_mag>)" ON <vof_stress_mask>
<<dim2comment>>CELL_CONSTANT <vof_ugrad_multiplier[l=2]> "<phi_normal_c[l=2]>*<vof_ugrad_l_constant>/(<vof_ugrad_l>*<phi_normal_c_mag>)" ON <vof_stress_mask>
<<dim3comment>>CELL_CONSTANT <vof_ugrad_multiplier[l=3]> "<phi_normal_c[l=3]>*<vof_ugrad_l_constant>/(<vof_ugrad_l>*<phi_normal_c_mag>)" ON <vof_stress_mask>
<<dim1comment>>               CELL_DERIVED <ugrad_vof_c[l=1,1]> "<vof_ugrad_multiplier[l=1]>*<u[l=1]>" ON <vof_stress_mask>
<<dim1comment>><<dim2comment>>CELL_DERIVED <ugrad_vof_c[l=1,2]> "<vof_ugrad_multiplier[l=1]>*<u[l=2]>" ON <vof_stress_mask>
<<dim1comment>><<dim3comment>>CELL_DERIVED <ugrad_vof_c[l=1,3]> "<vof_ugrad_multiplier[l=1]>*<u[l=3]>" ON <vof_stress_mask>
<<dim2comment>><<dim1comment>>CELL_DERIVED <ugrad_vof_c[l=2,1]> "<vof_ugrad_multiplier[l=2]>*<u[l=1]>" ON <vof_stress_mask>
<<dim2comment>>               CELL_DERIVED <ugrad_vof_c[l=2,2]> "<vof_ugrad_multiplier[l=2]>*<u[l=2]>" ON <vof_stress_mask>
<<dim2comment>><<dim3comment>>CELL_DERIVED <ugrad_vof_c[l=2,3]> "<vof_ugrad_multiplier[l=2]>*<u[l=3]>" ON <vof_stress_mask>
<<dim3comment>><<dim1comment>>CELL_DERIVED <ugrad_vof_c[l=3,1]> "<vof_ugrad_multiplier[l=3]>*<u[l=1]>" ON <vof_stress_mask>
<<dim3comment>><<dim2comment>>CELL_DERIVED <ugrad_vof_c[l=3,2]> "<vof_ugrad_multiplier[l=3]>*<u[l=2]>" ON <vof_stress_mask>
<<dim3comment>>               CELL_DERIVED <ugrad_vof_c[l=3,3]> "<vof_ugrad_multiplier[l=3]>*<u[l=3]>" ON <vof_stress_mask>

<<dim1comment>>CELL_LOCAL <tau_vof_c[l=1,1]> "-<mu>*2.d0*<ugrad_vof_c[l=1,1]>" ON <vof_stress_mask>
<<dim2comment>>CELL_LOCAL <tau_vof_c[l=2,2]> "-<mu>*2.d0*<ugrad_vof_c[l=2,2]>" ON <vof_stress_mask>
<<dim3comment>>CELL_LOCAL <tau_vof_c[l=3,3]> "-<mu>*2.d0*<ugrad_vof_c[l=3,3]>" ON <vof_stress_mask>
<<dim1comment>><<dim2comment>>CELL_LOCAL <tau_vof_c[l=1,2]> "-<mu>*(<ugrad_vof_c[l=1,2]>+<ugrad_vof_c[l=2,1]>)" ON <vof_stress_mask>
<<dim1comment>><<dim3comment>>CELL_LOCAL <tau_vof_c[l=1,3]> "-<mu>*(<ugrad_vof_c[l=1,3]>+<ugrad_vof_c[l=3,1]>)" ON <vof_stress_mask>
<<dim2comment>><<dim3comment>>CELL_LOCAL <tau_vof_c[l=2,3]> "-<mu>*(<ugrad_vof_c[l=2,3]>+<ugrad_vof_c[l=3,2]>)" ON <vof_stress_mask>
<<dim2comment>><<dim1comment>>CELL_LOCAL <tau_vof_c[l=2,1]> "<tau_vof_c[l=1,2]>" ON <vof_stress_mask>
<<dim3comment>><<dim1comment>>CELL_LOCAL <tau_vof_c[l=3,1]> "<tau_vof_c[l=1,3]>" ON <vof_stress_mask>
<<dim3comment>><<dim2comment>>CELL_LOCAL <tau_vof_c[l=3,2]> "<tau_vof_c[l=2,3]>" ON <vof_stress_mask>

# and also modify momentum equations, which are only solved within fluid region
<<dim1comment>>CELL_EQUATION <momentum[l=1]> "celldiv(<phi_f>*dot(<facenorm[l=:]>,<tau[l=:,1]>))-<phi_c>*<dynamic_force_c[l=1]>-cellif(celldelta(<vof_stress_mask>),dot(<phi_normal_c[l=:]>,<tau_vof_c[l=:,1]>))"
<<dim2comment>>CELL_EQUATION <momentum[l=2]> "celldiv(<phi_f>*dot(<facenorm[l=:]>,<tau[l=:,2]>))-<phi_c>*<dynamic_force_c[l=2]>-cellif(celldelta(<vof_stress_mask>),dot(<phi_normal_c[l=:]>,<tau_vof_c[l=:,2]>))"
<<dim3comment>>CELL_EQUATION <momentum[l=3]> "celldiv(<phi_f>*dot(<facenorm[l=:]>,<tau[l=:,3]>))-<phi_c>*<dynamic_force_c[l=3]>-cellif(celldelta(<vof_stress_mask>),dot(<phi_normal_c[l=:]>,<tau_vof_c[l=:,3]>))"
