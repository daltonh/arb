MARKDOWN
Here we setup the face flux velocity u_f for each phase, using the navier_stokes template file
END_MARKDOWN

# calculate the disperse species pressures
{{
  my $return_string = '';
  for my $species (string_eval('<<multifluid_disperse_species_list>>','list')) {
    $return_string .= "INCLUDE 'species_pressure' R '<<species>>' W '$species'\n";
    $return_string .= "INCLUDE 'species_drag' R '<<species>>' W '$species'\n";
  }
  return $return_string;
}}

# do the whole u_f thing, including defining the dynamic pressures, p_errors, etc
{{
  my $return_string = '';
  for my $species (string_eval('<<multifluid_species_list>>','list')) {
    $return_string .= "INCLUDE_TEMPLATE 'navier_stokes/u_f' ".
      "R '<u[' W '<u_$species"."[' R '<ugrad_f[' W '<ugrad_f_$species"."[' ".
      "R '<u_f_vect[' W '<u_f_vect_$species"."[' R '<mu_f>' W '<mu_f_$species>' ".
      "R '<u_f>' W '<u_f_$species>' R '<u_rf_{vis}>' W '<u_rf_{vis}_$species>' ".
      "R '<u_rf_{transient}>' W '<u_rf_{transient}_$species>' R '<u_rf_{adv}>' W '<u_rf_{adv}_$species>' ".
      "R '<u_f_{correction}>' W '<u_f_{correction}_$species>' R '<u_f_{raw}>' W '<u_f_{raw}_$species>' ".
      "R '<u_f_{correction}[' W '<u_f_{correction}_$species"."[' ".
      "R '<rho_f>' W '<rho_$species>' ".
      "R '<eps_p>' W '<eps_p_$species>' R '<p_error>' W '<p_error_$species>' ".
      "R '<dynamic_force_c_f[' W '<dynamic_force_c_f_$species"."[' ".
      "R '<dynamic_force_c[' W '<dynamic_force_c_$species"."[' ".
      "R '<dynamic_force_f>' W '<dynamic_force_f_$species>' ".
      "R '<p>' W '<p_species0>' R '<p_f>' W '<p_f_species0>'\n".
      "INCLUDE\n"
  }
  return $return_string;
}}

# add on osmotic pressure contribution to dynamic force for the disperse species
{{
  my $return_string = '';
  for my $species (string_eval('<<multifluid_disperse_species_list>>','list')) {
    $return_string .= "INCLUDE 'species_dynamic_force' R '<<species>>' W '$species'\n";
  }
  return $return_string;
}}
